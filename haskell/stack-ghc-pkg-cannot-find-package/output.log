lehins@lehins-HP:~/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar$ rm -r .stack-work/
lehins@lehins-HP:~/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar$ rm -r ../foo/.stack-work/
lehins@lehins-HP:~/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar$ stack build --verbose
Version 2.2.0, Git revision c3c33b61a4d5c286a6718550d285305270ba4bf0 PRE-RELEASE x86_64 hpack-0.31.2
2020-01-17 02:42:25.981776: [debug] Checking for project config at: /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/stack.yaml
2020-01-17 02:42:25.981966: [debug] Loading project config file stack.yaml
2020-01-17 02:42:25.985790: [debug] SELECT COUNT(*) FROM "last_performed" WHERE ("action"=?) AND ("timestamp">=?); [PersistInt64 1,PersistUTCTime 2020-01-15 23:42:25.985761 UTC]
2020-01-17 02:42:25.986274: [debug] Using package location completions from a lock file
2020-01-17 02:42:25.987796: [debug] Loaded snapshot from Pantry database.
2020-01-17 02:42:26.187189: [debug] Running hpack on /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/package.yaml
2020-01-17 02:42:26.190115: [debug] hpack output unchanged in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/bar.cabal
2020-01-17 02:42:26.190482: [debug] Running hpack on /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/package.yaml
2020-01-17 02:42:26.192753: [debug] hpack output unchanged in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:26.224563: [debug] Migration executed: CREATE TABLE "config_cache"("id" INTEGER PRIMARY KEY,"directory" VARCHAR NOT NULL DEFAULT (hex(randomblob(16))),"type" VARCHAR NOT NULL,"pkg_src" VARCHAR NOT NULL,"active" BOOLEAN NOT NULL,"path_env_var" VARCHAR NOT NULL,"haddock" BOOLEAN NOT NULL DEFAULT 0,CONSTRAINT "unique_config_cache" UNIQUE ("directory","type"))
2020-01-17 02:42:26.224720: [debug] Migration executed: CREATE TABLE "config_cache_dir_option"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","index" INTEGER NOT NULL,"option" VARCHAR NOT NULL,CONSTRAINT "unique_config_cache_dir_option" UNIQUE ("config_cache_id","index"))
2020-01-17 02:42:26.224792: [debug] Migration executed: CREATE TABLE "config_cache_no_dir_option"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","index" INTEGER NOT NULL,"option" VARCHAR NOT NULL,CONSTRAINT "unique_config_cache_no_dir_option" UNIQUE ("config_cache_id","index"))
2020-01-17 02:42:26.224860: [debug] Migration executed: CREATE TABLE "config_cache_dep"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","ghc_pkg_id" VARCHAR NOT NULL,CONSTRAINT "unique_config_cache_dep" UNIQUE ("config_cache_id","ghc_pkg_id"))
2020-01-17 02:42:26.224954: [debug] Migration executed: CREATE TABLE "config_cache_component"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","component" BLOB NOT NULL,CONSTRAINT "unique_config_cache_component" UNIQUE ("config_cache_id","component"))
2020-01-17 02:42:26.225270: [debug] Asking for a supported GHC version
2020-01-17 02:42:26.226775: [debug] Installed tools: 
 - ghc-8.6.3
 - ghc-8.0.2
 - ghc-7.10.2
 - ghc-8.6.5
 - ghc-8.0.1
 - ghc-8.2.2
 - ghc-8.6.2
 - ghc-8.8.1
 - ghc-8.6.4
 - ghc-7.10.3
 - ghc-8.4.4
 - ghc-7.8.4
 - ghc-8.4.3
2020-01-17 02:42:26.227386: [debug] Run process: /sbin/ldconfig -p
2020-01-17 02:42:26.229724: [debug] Process finished in 2ms: /sbin/ldconfig -p
2020-01-17 02:42:26.229953: [debug] Found shared library libtinfo.so.5 in 'ldconfig -p' output
2020-01-17 02:42:26.230462: [debug] Did not find shared library libtinfo.so.6
2020-01-17 02:42:26.230563: [debug] Did not find shared library libncursesw.so.6
2020-01-17 02:42:26.230634: [debug] Found shared library libgmp.so.10 in 'ldconfig -p' output
2020-01-17 02:42:26.230738: [debug] Did not find shared library libgmp.so.3
2020-01-17 02:42:26.230776: [debug] Potential GHC builds: standard
2020-01-17 02:42:26.230822: [debug] Found already installed GHC builds: standard
2020-01-17 02:42:26.231338: [debug] SELECT "id","actual_version","arch","ghc_path","ghc_size","ghc_modified","ghc_pkg_path","runghc_path","haddock_path","cabal_version","global_db","global_db_cache_size","global_db_cache_modified","info","global_dump" FROM "compiler_cache" WHERE "ghc_path"=?; [PersistText "/home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-8.6.5"]
2020-01-17 02:42:26.285829: [debug] Loaded compiler information from cache
2020-01-17 02:42:26.286009: [debug] Asking for a supported GHC version
2020-01-17 02:42:26.293776: [debug] Resolving package entries
2020-01-17 02:42:26.293893: [debug] Parsing the targets
2020-01-17 02:42:26.296260: [debug] Checking flags
2020-01-17 02:42:26.296327: [debug] SourceMap constructed
2020-01-17 02:42:26.301526: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 init /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb/
2020-01-17 02:42:26.320136: [debug] Process finished in 18ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 init /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb/
2020-01-17 02:42:26.320486: [debug] Starting to execute command inside EnvConfig
2020-01-17 02:42:26.324929: [debug] Finding out which packages are already installed
2020-01-17 02:42:26.325226: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --global --no-user-package-db dump --expand-pkgroot
2020-01-17 02:42:26.357390: [debug] Process finished in 32ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --global --no-user-package-db dump --expand-pkgroot
2020-01-17 02:42:26.369331: [debug] Ignoring package haskeline due to wanting version 0.7.5.0 instead of 0.7.4.3
2020-01-17 02:42:26.370237: [debug] Ignoring package Cabal due to wanting version 2.4.1.0 instead of 2.4.0.1
2020-01-17 02:42:26.370371: [debug] Ignoring package parsec due to wanting version 3.1.14.0 instead of 3.1.13.0
2020-01-17 02:42:26.371209: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:26.402661: [debug] Process finished in 31ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:26.403991: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:26.427662: [debug] Process finished in 24ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:26.428233: [debug] Constructing the build plan
2020-01-17 02:42:26.429578: [debug] Checking if we are going to build multiple executables with the same name
2020-01-17 02:42:26.429687: [debug] Executing the build plan
2020-01-17 02:42:26.431481: [info] Building all executables for `foo' once. After a successful build of all of them, only specified executables will be rebuilt.
2020-01-17 02:42:26.431773: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config"]
2020-01-17 02:42:26.432384: [debug] UPDATE "config_cache" SET "active"=? WHERE ("directory"=?) AND ("type"=?); [PersistBool False,PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config"]
2020-01-17 02:42:26.432670: [info] foo> configure (lib + exe)
2020-01-17 02:42:26.432985: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib --bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin --datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share --libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec --sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc --docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0 --htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0 --haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0 --dependency=base=base-4.12.0.0 --exact-configuration --ghc-option=-fhide-source-paths
2020-01-17 02:42:26.921739: [info] foo> Configuring foo-0.1.0.0...
2020-01-17 02:42:27.116409: [debug] Process finished in 683ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib --bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin --datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share --libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec --sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc --docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0 --htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0 --haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0 --dependency=base=base-4.12.0.0 --exact-configuration --ghc-option=-fhide-source-paths
2020-01-17 02:42:27.116718: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config"]
2020-01-17 02:42:27.116989: [debug] INSERT INTO "config_cache"("directory","type","pkg_src","active","path_env_var","haddock") VALUES(?,?,?,?,?,?); [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config",PersistText "local:/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistBool True,PersistText "/home/lehins/miniconda2/condabin:/home/lehins/adb-fastboot/platform-tools:/home/lehins/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:~/.ruby/bin:~/.ghcup/bin",PersistBool False]
2020-01-17 02:42:27.117444: [debug] SELECT "id" FROM "config_cache" WHERE _ROWID_=last_insert_rowid(); []
2020-01-17 02:42:27.117633: [debug] DELETE FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:27.117874: [debug] INSERT INTO "config_cache_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 1,PersistInt64 0,PersistText "--user",PersistInt64 1,PersistInt64 1,PersistText "--package-db=clear",PersistInt64 1,PersistInt64 2,PersistText "--package-db=global",PersistInt64 1,PersistInt64 3,PersistText "--package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 1,PersistInt64 4,PersistText "--package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 1,PersistInt64 5,PersistText "--libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib",PersistInt64 1,PersistInt64 6,PersistText "--bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin",PersistInt64 1,PersistInt64 7,PersistText "--datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share",PersistInt64 1,PersistInt64 8,PersistText "--libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec",PersistInt64 1,PersistInt64 9,PersistText "--sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc",PersistInt64 1,PersistInt64 10,PersistText "--docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0",PersistInt64 1,PersistInt64 11,PersistText "--htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0",PersistInt64 1,PersistInt64 12,PersistText "--haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0"]
2020-01-17 02:42:27.118492: [debug] DELETE FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:27.118691: [debug] INSERT INTO "config_cache_no_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?); [PersistInt64 1,PersistInt64 0,PersistText "--dependency=base=base-4.12.0.0",PersistInt64 1,PersistInt64 1,PersistText "--exact-configuration",PersistInt64 1,PersistInt64 2,PersistText "--ghc-option=-fhide-source-paths"]
2020-01-17 02:42:27.119225: [debug] DELETE FROM "config_cache_dep" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:27.119421: [debug] INSERT INTO "config_cache_dep"("config_cache_id","ghc_pkg_id") VALUES (?,?); [PersistInt64 1,PersistText "base-4.12.0.0"]
2020-01-17 02:42:27.119666: [debug] DELETE FROM "config_cache_component" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:27.119865: [debug] INSERT INTO "config_cache_component"("config_cache_id","component") VALUES (?,?); [PersistInt64 1,PersistByteString "exe:foo-exe"]
2020-01-17 02:42:27.147374: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:27.151132: [debug] Finished in 4ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:27.152690: [info] foo> build (lib + exe)
2020-01-17 02:42:27.152844: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:foo exe:foo-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:27.196908: [info] foo> Preprocessing library for foo-0.1.0.0..
2020-01-17 02:42:27.197034: [info] foo> Building library for foo-0.1.0.0..
2020-01-17 02:42:27.276621: [info] foo> [1 of 2] Compiling Lib
2020-01-17 02:42:27.364325: [info] foo> [2 of 2] Compiling Paths_foo
2020-01-17 02:42:27.758737: [info] foo> Preprocessing executable 'foo-exe' for foo-0.1.0.0..
2020-01-17 02:42:27.759198: [info] foo> Building executable 'foo-exe' for foo-0.1.0.0..
2020-01-17 02:42:27.838529: [info] foo> [1 of 2] Compiling Main
2020-01-17 02:42:27.926019: [info] foo> [2 of 2] Compiling Paths_foo
2020-01-17 02:42:28.159289: [info] foo> Linking .stack-work/dist/x86_64-linux/Cabal-2.4.0.1/build/foo-exe/foo-exe ...
2020-01-17 02:42:28.576788: [debug] Process finished in 1424ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:foo exe:foo-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:28.576985: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:28.581712: [debug] Finished in 5ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:28.583646: [info] foo> copy/register
2020-01-17 02:42:28.584029: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:28.613500: [info] foo> Installing library in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib/x86_64-linux-ghc-8.6.5/foo-0.1.0.0-LplreLjcOnnO4k14IKdYr
2020-01-17 02:42:28.624442: [info] foo> Installing executable foo-exe in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin
2020-01-17 02:42:28.638170: [debug] Process finished in 54ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:28.638393: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:28.774750: [info] foo> Registering library for foo-0.1.0.0..
2020-01-17 02:42:28.782066: [debug] Process finished in 144ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:28.782423: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb describe --simple-output foo --expand-pkgroot
2020-01-17 02:42:28.810731: [debug] Process finished in 28ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb describe --simple-output foo --expand-pkgroot
2020-01-17 02:42:28.811117: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/",PersistText "lib:foo-0.1.0.0-LplreLjcOnnO4k14IKdYr"]
2020-01-17 02:42:28.811405: [debug] INSERT INTO "config_cache"("directory","type","pkg_src","active","path_env_var","haddock") VALUES(?,?,?,?,?,?); [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/",PersistText "lib:foo-0.1.0.0-LplreLjcOnnO4k14IKdYr",PersistText "local:/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistBool True,PersistText "/home/lehins/miniconda2/condabin:/home/lehins/adb-fastboot/platform-tools:/home/lehins/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:~/.ruby/bin:~/.ghcup/bin",PersistBool False]
2020-01-17 02:42:28.811688: [debug] SELECT "id" FROM "config_cache" WHERE _ROWID_=last_insert_rowid(); []
2020-01-17 02:42:28.811988: [debug] DELETE FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:28.812126: [debug] INSERT INTO "config_cache_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 2,PersistInt64 0,PersistText "--user",PersistInt64 2,PersistInt64 1,PersistText "--package-db=clear",PersistInt64 2,PersistInt64 2,PersistText "--package-db=global",PersistInt64 2,PersistInt64 3,PersistText "--package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 2,PersistInt64 4,PersistText "--package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 2,PersistInt64 5,PersistText "--libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib",PersistInt64 2,PersistInt64 6,PersistText "--bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin",PersistInt64 2,PersistInt64 7,PersistText "--datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share",PersistInt64 2,PersistInt64 8,PersistText "--libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec",PersistInt64 2,PersistInt64 9,PersistText "--sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc",PersistInt64 2,PersistInt64 10,PersistText "--docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0",PersistInt64 2,PersistInt64 11,PersistText "--htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0",PersistInt64 2,PersistInt64 12,PersistText "--haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/foo-0.1.0.0"]
2020-01-17 02:42:28.812544: [debug] DELETE FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:28.812661: [debug] INSERT INTO "config_cache_no_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?); [PersistInt64 2,PersistInt64 0,PersistText "--dependency=base=base-4.12.0.0",PersistInt64 2,PersistInt64 1,PersistText "--exact-configuration",PersistInt64 2,PersistInt64 2,PersistText "--ghc-option=-fhide-source-paths"]
2020-01-17 02:42:28.812844: [debug] DELETE FROM "config_cache_dep" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:28.812962: [debug] INSERT INTO "config_cache_dep"("config_cache_id","ghc_pkg_id") VALUES (?,?); [PersistInt64 2,PersistText "base-4.12.0.0"]
2020-01-17 02:42:28.813117: [debug] DELETE FROM "config_cache_component" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:28.813228: [debug] INSERT INTO "config_cache_component"("config_cache_id","component") VALUES (?,?); [PersistInt64 2,PersistByteString "exe:foo-exe"]
2020-01-17 02:42:28.855395: [info] Building all executables for `bar' once. After a successful build of all of them, only specified executables will be rebuilt.
2020-01-17 02:42:28.855593: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/",PersistText "config"]
2020-01-17 02:42:28.855835: [debug] UPDATE "config_cache" SET "active"=? WHERE ("directory"=?) AND ("type"=?); [PersistBool False,PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/",PersistText "config"]
2020-01-17 02:42:28.856028: [info] bar> configure (lib + exe)
2020-01-17 02:42:28.856243: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib --bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin --datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share --libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec --sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc --docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0 --htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0 --haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0 --dependency=base=base-4.12.0.0 --dependency=foo=foo-0.1.0.0-LplreLjcOnnO4k14IKdYr --exact-configuration --ghc-option=-fhide-source-paths
2020-01-17 02:42:29.337689: [info] bar> Configuring bar-0.1.0.0...
2020-01-17 02:42:29.551015: [debug] Process finished in 694ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb --libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib --bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin --datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share --libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec --sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc --docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0 --htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0 --haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0 --dependency=base=base-4.12.0.0 --dependency=foo=foo-0.1.0.0-LplreLjcOnnO4k14IKdYr --exact-configuration --ghc-option=-fhide-source-paths
2020-01-17 02:42:29.551303: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/",PersistText "config"]
2020-01-17 02:42:29.551520: [debug] INSERT INTO "config_cache"("directory","type","pkg_src","active","path_env_var","haddock") VALUES(?,?,?,?,?,?); [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/",PersistText "config",PersistText "local:/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/",PersistBool True,PersistText "/home/lehins/miniconda2/condabin:/home/lehins/adb-fastboot/platform-tools:/home/lehins/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:~/.ruby/bin:~/.ghcup/bin",PersistBool False]
2020-01-17 02:42:29.551909: [debug] SELECT "id" FROM "config_cache" WHERE _ROWID_=last_insert_rowid(); []
2020-01-17 02:42:29.552050: [debug] DELETE FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 3]
2020-01-17 02:42:29.552213: [debug] INSERT INTO "config_cache_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 3,PersistInt64 0,PersistText "--user",PersistInt64 3,PersistInt64 1,PersistText "--package-db=clear",PersistInt64 3,PersistInt64 2,PersistText "--package-db=global",PersistInt64 3,PersistInt64 3,PersistText "--package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 3,PersistInt64 4,PersistText "--package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 3,PersistInt64 5,PersistText "--libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib",PersistInt64 3,PersistInt64 6,PersistText "--bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin",PersistInt64 3,PersistInt64 7,PersistText "--datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share",PersistInt64 3,PersistInt64 8,PersistText "--libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec",PersistInt64 3,PersistInt64 9,PersistText "--sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc",PersistInt64 3,PersistInt64 10,PersistText "--docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0",PersistInt64 3,PersistInt64 11,PersistText "--htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0",PersistInt64 3,PersistInt64 12,PersistText "--haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0"]
2020-01-17 02:42:29.552736: [debug] DELETE FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 3]
2020-01-17 02:42:29.552878: [debug] INSERT INTO "config_cache_no_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 3,PersistInt64 0,PersistText "--dependency=base=base-4.12.0.0",PersistInt64 3,PersistInt64 1,PersistText "--dependency=foo=foo-0.1.0.0-LplreLjcOnnO4k14IKdYr",PersistInt64 3,PersistInt64 2,PersistText "--exact-configuration",PersistInt64 3,PersistInt64 3,PersistText "--ghc-option=-fhide-source-paths"]
2020-01-17 02:42:29.553333: [debug] DELETE FROM "config_cache_dep" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 3]
2020-01-17 02:42:29.553495: [debug] INSERT INTO "config_cache_dep"("config_cache_id","ghc_pkg_id") VALUES (?,?),(?,?); [PersistInt64 3,PersistText "base-4.12.0.0",PersistInt64 3,PersistText "foo-0.1.0.0-LplreLjcOnnO4k14IKdYr"]
2020-01-17 02:42:29.553773: [debug] DELETE FROM "config_cache_component" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 3]
2020-01-17 02:42:29.553940: [debug] INSERT INTO "config_cache_component"("config_cache_id","component") VALUES (?,?); [PersistInt64 3,PersistByteString "exe:bar-exe"]
2020-01-17 02:42:29.580808: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/bar.cabal
2020-01-17 02:42:29.585734: [debug] Finished in 5ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/bar.cabal
2020-01-17 02:42:29.587625: [info] bar> build (lib + exe)
2020-01-17 02:42:29.587803: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:bar exe:bar-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:29.629343: [info] bar> Preprocessing library for bar-0.1.0.0..
2020-01-17 02:42:29.629534: [info] bar> Building library for bar-0.1.0.0..
2020-01-17 02:42:29.709177: [info] bar> [1 of 2] Compiling Bar
2020-01-17 02:42:29.770749: [info] bar> [2 of 2] Compiling Paths_bar
2020-01-17 02:42:30.210998: [info] bar> Preprocessing executable 'bar-exe' for bar-0.1.0.0..
2020-01-17 02:42:30.211141: [info] bar> Building executable 'bar-exe' for bar-0.1.0.0..
2020-01-17 02:42:30.300178: [info] bar> [1 of 2] Compiling Main
2020-01-17 02:42:30.391733: [info] bar> [2 of 2] Compiling Paths_bar
2020-01-17 02:42:30.638547: [info] bar> Linking .stack-work/dist/x86_64-linux/Cabal-2.4.0.1/build/bar-exe/bar-exe ...
2020-01-17 02:42:31.041125: [debug] Process finished in 1453ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:bar exe:bar-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:31.041365: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/bar.cabal
2020-01-17 02:42:31.045871: [debug] Finished in 4ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/bar.cabal
2020-01-17 02:42:31.047455: [info] bar> copy/register
2020-01-17 02:42:31.047745: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:31.072883: [info] bar> Installing library in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib/x86_64-linux-ghc-8.6.5/bar-0.1.0.0-Als2OLbMFv7BR5x6Mmi9yt
2020-01-17 02:42:31.084314: [info] bar> Installing executable bar-exe in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin
2020-01-17 02:42:31.091252: [debug] Process finished in 43ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:31.091465: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:31.221285: [info] bar> Registering library for bar-0.1.0.0..
2020-01-17 02:42:31.224257: [debug] Process finished in 133ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:31.224640: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb describe --simple-output bar --expand-pkgroot
2020-01-17 02:42:31.257145: [debug] Process finished in 32ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb describe --simple-output bar --expand-pkgroot
2020-01-17 02:42:31.257423: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/",PersistText "lib:bar-0.1.0.0-Als2OLbMFv7BR5x6Mmi9yt"]
2020-01-17 02:42:31.257672: [debug] INSERT INTO "config_cache"("directory","type","pkg_src","active","path_env_var","haddock") VALUES(?,?,?,?,?,?); [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/",PersistText "lib:bar-0.1.0.0-Als2OLbMFv7BR5x6Mmi9yt",PersistText "local:/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/",PersistBool True,PersistText "/home/lehins/miniconda2/condabin:/home/lehins/adb-fastboot/platform-tools:/home/lehins/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:~/.ruby/bin:~/.ghcup/bin",PersistBool False]
2020-01-17 02:42:31.257940: [debug] SELECT "id" FROM "config_cache" WHERE _ROWID_=last_insert_rowid(); []
2020-01-17 02:42:31.258161: [debug] DELETE FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 4]
2020-01-17 02:42:31.258285: [debug] INSERT INTO "config_cache_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 4,PersistInt64 0,PersistText "--user",PersistInt64 4,PersistInt64 1,PersistText "--package-db=clear",PersistInt64 4,PersistInt64 2,PersistText "--package-db=global",PersistInt64 4,PersistInt64 3,PersistText "--package-db=/home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 4,PersistInt64 4,PersistText "--package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb",PersistInt64 4,PersistInt64 5,PersistText "--libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/lib",PersistInt64 4,PersistInt64 6,PersistText "--bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/bin",PersistInt64 4,PersistInt64 7,PersistText "--datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/share",PersistInt64 4,PersistInt64 8,PersistText "--libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/libexec",PersistInt64 4,PersistInt64 9,PersistText "--sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/etc",PersistInt64 4,PersistInt64 10,PersistText "--docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0",PersistInt64 4,PersistInt64 11,PersistText "--htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0",PersistInt64 4,PersistInt64 12,PersistText "--haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/doc/bar-0.1.0.0"]
2020-01-17 02:42:31.258662: [debug] DELETE FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 4]
2020-01-17 02:42:31.258760: [debug] INSERT INTO "config_cache_no_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 4,PersistInt64 0,PersistText "--dependency=base=base-4.12.0.0",PersistInt64 4,PersistInt64 1,PersistText "--dependency=foo=foo-0.1.0.0-LplreLjcOnnO4k14IKdYr",PersistInt64 4,PersistInt64 2,PersistText "--exact-configuration",PersistInt64 4,PersistInt64 3,PersistText "--ghc-option=-fhide-source-paths"]
2020-01-17 02:42:31.258962: [debug] DELETE FROM "config_cache_dep" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 4]
2020-01-17 02:42:31.259056: [debug] INSERT INTO "config_cache_dep"("config_cache_id","ghc_pkg_id") VALUES (?,?),(?,?); [PersistInt64 4,PersistText "base-4.12.0.0",PersistInt64 4,PersistText "foo-0.1.0.0-LplreLjcOnnO4k14IKdYr"]
2020-01-17 02:42:31.259189: [debug] DELETE FROM "config_cache_component" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 4]
2020-01-17 02:42:31.259281: [debug] INSERT INTO "config_cache_component"("config_cache_id","component") VALUES (?,?); [PersistInt64 4,PersistByteString "exe:bar-exe"]
2020-01-17 02:42:31.299902: [info] Completed 2 action(s).
lehins@lehins-HP:~/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar$ cd ../foo/
lehins@lehins-HP:~/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo$ stack build --verbose
Version 2.2.0, Git revision c3c33b61a4d5c286a6718550d285305270ba4bf0 PRE-RELEASE x86_64 hpack-0.31.2
2020-01-17 02:42:42.064384: [debug] Checking for project config at: /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/stack.yaml
2020-01-17 02:42:42.064592: [debug] Loading project config file stack.yaml
2020-01-17 02:42:42.071246: [debug] SELECT COUNT(*) FROM "last_performed" WHERE ("action"=?) AND ("timestamp">=?); [PersistInt64 1,PersistUTCTime 2020-01-15 23:42:42.071216 UTC]
2020-01-17 02:42:42.071751: [debug] Using package location completions from a lock file
2020-01-17 02:42:42.073310: [debug] Loaded snapshot from Pantry database.
2020-01-17 02:42:42.262051: [debug] Running hpack on /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/package.yaml
2020-01-17 02:42:42.264818: [debug] hpack output unchanged in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:42.294659: [debug] Migration executed: CREATE TABLE "config_cache"("id" INTEGER PRIMARY KEY,"directory" VARCHAR NOT NULL DEFAULT (hex(randomblob(16))),"type" VARCHAR NOT NULL,"pkg_src" VARCHAR NOT NULL,"active" BOOLEAN NOT NULL,"path_env_var" VARCHAR NOT NULL,"haddock" BOOLEAN NOT NULL DEFAULT 0,CONSTRAINT "unique_config_cache" UNIQUE ("directory","type"))
2020-01-17 02:42:42.294826: [debug] Migration executed: CREATE TABLE "config_cache_dir_option"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","index" INTEGER NOT NULL,"option" VARCHAR NOT NULL,CONSTRAINT "unique_config_cache_dir_option" UNIQUE ("config_cache_id","index"))
2020-01-17 02:42:42.295032: [debug] Migration executed: CREATE TABLE "config_cache_no_dir_option"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","index" INTEGER NOT NULL,"option" VARCHAR NOT NULL,CONSTRAINT "unique_config_cache_no_dir_option" UNIQUE ("config_cache_id","index"))
2020-01-17 02:42:42.295141: [debug] Migration executed: CREATE TABLE "config_cache_dep"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","ghc_pkg_id" VARCHAR NOT NULL,CONSTRAINT "unique_config_cache_dep" UNIQUE ("config_cache_id","ghc_pkg_id"))
2020-01-17 02:42:42.295208: [debug] Migration executed: CREATE TABLE "config_cache_component"("id" INTEGER PRIMARY KEY,"config_cache_id" INTEGER NOT NULL REFERENCES "config_cache","component" BLOB NOT NULL,CONSTRAINT "unique_config_cache_component" UNIQUE ("config_cache_id","component"))
2020-01-17 02:42:42.295546: [debug] Asking for a supported GHC version
2020-01-17 02:42:42.297000: [debug] Installed tools: 
 - ghc-8.6.3
 - ghc-8.0.2
 - ghc-7.10.2
 - ghc-8.6.5
 - ghc-8.0.1
 - ghc-8.2.2
 - ghc-8.6.2
 - ghc-8.8.1
 - ghc-8.6.4
 - ghc-7.10.3
 - ghc-8.4.4
 - ghc-7.8.4
 - ghc-8.4.3
2020-01-17 02:42:42.297732: [debug] Run process: /sbin/ldconfig -p
2020-01-17 02:42:42.300614: [debug] Process finished in 3ms: /sbin/ldconfig -p
2020-01-17 02:42:42.301171: [debug] Found shared library libtinfo.so.5 in 'ldconfig -p' output
2020-01-17 02:42:42.302025: [debug] Did not find shared library libtinfo.so.6
2020-01-17 02:42:42.302190: [debug] Did not find shared library libncursesw.so.6
2020-01-17 02:42:42.302297: [debug] Found shared library libgmp.so.10 in 'ldconfig -p' output
2020-01-17 02:42:42.302436: [debug] Did not find shared library libgmp.so.3
2020-01-17 02:42:42.302508: [debug] Potential GHC builds: standard
2020-01-17 02:42:42.302591: [debug] Found already installed GHC builds: standard
2020-01-17 02:42:42.302985: [debug] SELECT "id","actual_version","arch","ghc_path","ghc_size","ghc_modified","ghc_pkg_path","runghc_path","haddock_path","cabal_version","global_db","global_db_cache_size","global_db_cache_modified","info","global_dump" FROM "compiler_cache" WHERE "ghc_path"=?; [PersistText "/home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-8.6.5"]
2020-01-17 02:42:42.360694: [debug] Loaded compiler information from cache
2020-01-17 02:42:42.360874: [debug] Asking for a supported GHC version
2020-01-17 02:42:42.361688: [debug] Resolving package entries
2020-01-17 02:42:42.361761: [debug] Parsing the targets
2020-01-17 02:42:42.364393: [debug] Checking flags
2020-01-17 02:42:42.364474: [debug] SourceMap constructed
2020-01-17 02:42:42.376510: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 init /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb/
2020-01-17 02:42:42.396776: [debug] Process finished in 20ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 init /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb/
2020-01-17 02:42:42.397048: [debug] Starting to execute command inside EnvConfig
2020-01-17 02:42:42.399152: [debug] Finding out which packages are already installed
2020-01-17 02:42:42.399336: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --global --no-user-package-db dump --expand-pkgroot
2020-01-17 02:42:42.435962: [debug] Process finished in 37ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --global --no-user-package-db dump --expand-pkgroot
2020-01-17 02:42:42.438881: [debug] Ignoring package haskeline due to wanting version 0.7.5.0 instead of 0.7.4.3
2020-01-17 02:42:42.440206: [debug] Ignoring package Cabal due to wanting version 2.4.1.0 instead of 2.4.0.1
2020-01-17 02:42:42.440438: [debug] Ignoring package parsec due to wanting version 3.1.14.0 instead of 3.1.13.0
2020-01-17 02:42:42.441594: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/.stack/snapshots/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:42.500876: [debug] Process finished in 59ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/.stack/snapshots/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:42.508684: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:42.536505: [debug] Process finished in 28ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:42.536886: [debug] Constructing the build plan
2020-01-17 02:42:42.538618: [debug] Checking if we are going to build multiple executables with the same name
2020-01-17 02:42:42.538690: [debug] Executing the build plan
2020-01-17 02:42:42.539919: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config"]
2020-01-17 02:42:42.540512: [debug] UPDATE "config_cache" SET "active"=? WHERE ("directory"=?) AND ("type"=?); [PersistBool False,PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config"]
2020-01-17 02:42:42.540750: [info] foo> configure (lib + exe)
2020-01-17 02:42:42.541047: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/home/lehins/.stack/snapshots/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb --libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/lib --bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/bin --datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/share --libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/libexec --sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/etc --docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0 --htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0 --haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0 --dependency=base=base-4.12.0.0 --exact-configuration --ghc-option=-fhide-source-paths
2020-01-17 02:42:43.167498: [info] Configuring foo-0.1.0.0...
2020-01-17 02:42:43.365908: [debug] Process finished in 824ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 configure --user --package-db=clear --package-db=global --package-db=/home/lehins/.stack/snapshots/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb --libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/lib --bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/bin --datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/share --libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/libexec --sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/etc --docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0 --htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0 --haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0 --dependency=base=base-4.12.0.0 --exact-configuration --ghc-option=-fhide-source-paths
2020-01-17 02:42:43.366245: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config"]
2020-01-17 02:42:43.366515: [debug] INSERT INTO "config_cache"("directory","type","pkg_src","active","path_env_var","haddock") VALUES(?,?,?,?,?,?); [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config",PersistText "local:/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistBool True,PersistText "/home/lehins/miniconda2/condabin:/home/lehins/adb-fastboot/platform-tools:/home/lehins/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:~/.ruby/bin:~/.ghcup/bin",PersistBool False]
2020-01-17 02:42:43.367044: [debug] SELECT "id" FROM "config_cache" WHERE _ROWID_=last_insert_rowid(); []
2020-01-17 02:42:43.367260: [debug] DELETE FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:43.367489: [debug] INSERT INTO "config_cache_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 1,PersistInt64 0,PersistText "--user",PersistInt64 1,PersistInt64 1,PersistText "--package-db=clear",PersistInt64 1,PersistInt64 2,PersistText "--package-db=global",PersistInt64 1,PersistInt64 3,PersistText "--package-db=/home/lehins/.stack/snapshots/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb",PersistInt64 1,PersistInt64 4,PersistText "--package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb",PersistInt64 1,PersistInt64 5,PersistText "--libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/lib",PersistInt64 1,PersistInt64 6,PersistText "--bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/bin",PersistInt64 1,PersistInt64 7,PersistText "--datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/share",PersistInt64 1,PersistInt64 8,PersistText "--libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/libexec",PersistInt64 1,PersistInt64 9,PersistText "--sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/etc",PersistInt64 1,PersistInt64 10,PersistText "--docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0",PersistInt64 1,PersistInt64 11,PersistText "--htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0",PersistInt64 1,PersistInt64 12,PersistText "--haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0"]
2020-01-17 02:42:43.368142: [debug] DELETE FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:43.368361: [debug] INSERT INTO "config_cache_no_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?); [PersistInt64 1,PersistInt64 0,PersistText "--dependency=base=base-4.12.0.0",PersistInt64 1,PersistInt64 1,PersistText "--exact-configuration",PersistInt64 1,PersistInt64 2,PersistText "--ghc-option=-fhide-source-paths"]
2020-01-17 02:42:43.368810: [debug] DELETE FROM "config_cache_dep" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:43.369028: [debug] INSERT INTO "config_cache_dep"("config_cache_id","ghc_pkg_id") VALUES (?,?); [PersistInt64 1,PersistText "base-4.12.0.0"]
2020-01-17 02:42:43.369308: [debug] DELETE FROM "config_cache_component" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 1]
2020-01-17 02:42:43.369514: [debug] INSERT INTO "config_cache_component"("config_cache_id","component") VALUES (?,?); [PersistInt64 1,PersistByteString "exe:foo-exe"]
2020-01-17 02:42:43.396362: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:43.400614: [debug] Finished in 4ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:43.402754: [info] foo> build (lib + exe)
2020-01-17 02:42:43.403099: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:foo exe:foo-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:43.438670: [info] Preprocessing library for foo-0.1.0.0..
2020-01-17 02:42:43.438877: [info] Building library for foo-0.1.0.0..
2020-01-17 02:42:43.552476: [info] [2 of 2] Compiling Paths_foo
2020-01-17 02:42:43.994617: [info] Preprocessing executable 'foo-exe' for foo-0.1.0.0..
2020-01-17 02:42:43.994769: [info] Building executable 'foo-exe' for foo-0.1.0.0..
2020-01-17 02:42:44.120644: [info] [2 of 2] Compiling Paths_foo
2020-01-17 02:42:44.444725: [info] Linking .stack-work/dist/x86_64-linux/Cabal-2.4.0.1/build/foo-exe/foo-exe ...
2020-01-17 02:42:44.847079: [debug] Process finished in 1444ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:foo exe:foo-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:44.847270: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:44.850994: [debug] Finished in 4ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:44.852558: [info] foo> copy/register
2020-01-17 02:42:44.852869: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:44.880475: [info] Installing library in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/lib/x86_64-linux-ghc-8.6.5/foo-0.1.0.0-LplreLjcOnnO4k14IKdYr
2020-01-17 02:42:44.889188: [info] Installing executable foo-exe in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/bin
2020-01-17 02:42:44.896320: [debug] Process finished in 43ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:44.896629: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:45.042362: [info] Registering library for foo-0.1.0.0..
2020-01-17 02:42:45.049920: [debug] Process finished in 153ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:45.050297: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb describe --simple-output foo --expand-pkgroot
2020-01-17 02:42:45.078449: [debug] Process finished in 28ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb describe --simple-output foo --expand-pkgroot
2020-01-17 02:42:45.078838: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/",PersistText "lib:foo-0.1.0.0-LplreLjcOnnO4k14IKdYr"]
2020-01-17 02:42:45.079162: [debug] INSERT INTO "config_cache"("directory","type","pkg_src","active","path_env_var","haddock") VALUES(?,?,?,?,?,?); [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/",PersistText "lib:foo-0.1.0.0-LplreLjcOnnO4k14IKdYr",PersistText "local:/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistBool True,PersistText "/home/lehins/miniconda2/condabin:/home/lehins/adb-fastboot/platform-tools:/home/lehins/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:~/.ruby/bin:~/.ghcup/bin",PersistBool False]
2020-01-17 02:42:45.079403: [debug] SELECT "id" FROM "config_cache" WHERE _ROWID_=last_insert_rowid(); []
2020-01-17 02:42:45.079485: [debug] DELETE FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:45.079701: [debug] INSERT INTO "config_cache_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?),(?,?,?); [PersistInt64 2,PersistInt64 0,PersistText "--user",PersistInt64 2,PersistInt64 1,PersistText "--package-db=clear",PersistInt64 2,PersistInt64 2,PersistText "--package-db=global",PersistInt64 2,PersistInt64 3,PersistText "--package-db=/home/lehins/.stack/snapshots/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb",PersistInt64 2,PersistInt64 4,PersistText "--package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/pkgdb",PersistInt64 2,PersistInt64 5,PersistText "--libdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/lib",PersistInt64 2,PersistInt64 6,PersistText "--bindir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/bin",PersistInt64 2,PersistInt64 7,PersistText "--datadir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/share",PersistInt64 2,PersistInt64 8,PersistText "--libexecdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/libexec",PersistInt64 2,PersistInt64 9,PersistText "--sysconfdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/etc",PersistInt64 2,PersistInt64 10,PersistText "--docdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0",PersistInt64 2,PersistInt64 11,PersistText "--htmldir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0",PersistInt64 2,PersistInt64 12,PersistText "--haddockdir=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/doc/foo-0.1.0.0"]
2020-01-17 02:42:45.080058: [debug] DELETE FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:45.080141: [debug] INSERT INTO "config_cache_no_dir_option"("config_cache_id","index","option") VALUES (?,?,?),(?,?,?),(?,?,?); [PersistInt64 2,PersistInt64 0,PersistText "--dependency=base=base-4.12.0.0",PersistInt64 2,PersistInt64 1,PersistText "--exact-configuration",PersistInt64 2,PersistInt64 2,PersistText "--ghc-option=-fhide-source-paths"]
2020-01-17 02:42:45.080274: [debug] DELETE FROM "config_cache_dep" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:45.080352: [debug] INSERT INTO "config_cache_dep"("config_cache_id","ghc_pkg_id") VALUES (?,?); [PersistInt64 2,PersistText "base-4.12.0.0"]
2020-01-17 02:42:45.080462: [debug] DELETE FROM "config_cache_component" WHERE ("config_cache_id"=?) AND (1=2); [PersistInt64 2]
2020-01-17 02:42:45.080540: [debug] INSERT INTO "config_cache_component"("config_cache_id","component") VALUES (?,?); [PersistInt64 2,PersistByteString "exe:foo-exe"]
lehins@lehins-HP:~/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo$ cd ../bar/
lehins@lehins-HP:~/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar$ stack build --verbose --force-dirty
Version 2.2.0, Git revision c3c33b61a4d5c286a6718550d285305270ba4bf0 PRE-RELEASE x86_64 hpack-0.31.2
2020-01-17 02:42:54.939907: [debug] Checking for project config at: /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/stack.yaml
2020-01-17 02:42:54.940106: [debug] Loading project config file stack.yaml
2020-01-17 02:42:54.947417: [debug] SELECT COUNT(*) FROM "last_performed" WHERE ("action"=?) AND ("timestamp">=?); [PersistInt64 1,PersistUTCTime 2020-01-15 23:42:54.947365 UTC]
2020-01-17 02:42:54.948173: [debug] Using package location completions from a lock file
2020-01-17 02:42:54.950605: [debug] Loaded snapshot from Pantry database.
2020-01-17 02:42:55.159608: [debug] Running hpack on /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/package.yaml
2020-01-17 02:42:55.162427: [debug] hpack output unchanged in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/bar.cabal
2020-01-17 02:42:55.162884: [debug] Running hpack on /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/package.yaml
2020-01-17 02:42:55.164993: [debug] hpack output unchanged in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:55.167520: [debug] Asking for a supported GHC version
2020-01-17 02:42:55.168434: [debug] Installed tools: 
 - ghc-8.6.3
 - ghc-8.0.2
 - ghc-7.10.2
 - ghc-8.6.5
 - ghc-8.0.1
 - ghc-8.2.2
 - ghc-8.6.2
 - ghc-8.8.1
 - ghc-8.6.4
 - ghc-7.10.3
 - ghc-8.4.4
 - ghc-7.8.4
 - ghc-8.4.3
2020-01-17 02:42:55.168895: [debug] Run process: /sbin/ldconfig -p
2020-01-17 02:42:55.171482: [debug] Process finished in 3ms: /sbin/ldconfig -p
2020-01-17 02:42:55.171696: [debug] Found shared library libtinfo.so.5 in 'ldconfig -p' output
2020-01-17 02:42:55.172090: [debug] Did not find shared library libtinfo.so.6
2020-01-17 02:42:55.172180: [debug] Did not find shared library libncursesw.so.6
2020-01-17 02:42:55.172249: [debug] Found shared library libgmp.so.10 in 'ldconfig -p' output
2020-01-17 02:42:55.172325: [debug] Did not find shared library libgmp.so.3
2020-01-17 02:42:55.172370: [debug] Potential GHC builds: standard
2020-01-17 02:42:55.172413: [debug] Found already installed GHC builds: standard
2020-01-17 02:42:55.172664: [debug] SELECT "id","actual_version","arch","ghc_path","ghc_size","ghc_modified","ghc_pkg_path","runghc_path","haddock_path","cabal_version","global_db","global_db_cache_size","global_db_cache_modified","info","global_dump" FROM "compiler_cache" WHERE "ghc_path"=?; [PersistText "/home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-8.6.5"]
2020-01-17 02:42:55.241098: [debug] Loaded compiler information from cache
2020-01-17 02:42:55.241279: [debug] Asking for a supported GHC version
2020-01-17 02:42:55.242120: [debug] Resolving package entries
2020-01-17 02:42:55.242182: [debug] Parsing the targets
2020-01-17 02:42:55.244833: [debug] Checking flags
2020-01-17 02:42:55.244908: [debug] SourceMap constructed
2020-01-17 02:42:55.249953: [debug] Starting to execute command inside EnvConfig
2020-01-17 02:42:55.252513: [debug] Finding out which packages are already installed
2020-01-17 02:42:55.252704: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --global --no-user-package-db dump --expand-pkgroot
2020-01-17 02:42:55.290488: [debug] Process finished in 38ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --global --no-user-package-db dump --expand-pkgroot
2020-01-17 02:42:55.294153: [debug] Ignoring package haskeline due to wanting version 0.7.5.0 instead of 0.7.4.3
2020-01-17 02:42:55.295806: [debug] Ignoring package Cabal due to wanting version 2.4.1.0 instead of 2.4.0.1
2020-01-17 02:42:55.296180: [debug] Ignoring package parsec due to wanting version 3.1.14.0 instead of 3.1.13.0
2020-01-17 02:42:55.297519: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:55.328070: [debug] Process finished in 30ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/.stack/snapshots/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:55.342374: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:55.371360: [debug] Process finished in 29ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb dump --expand-pkgroot
2020-01-17 02:42:55.372227: [debug] Constructing the build plan
2020-01-17 02:42:55.374090: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/",PersistText "lib:foo-0.1.0.0-LplreLjcOnnO4k14IKdYr"]
2020-01-17 02:42:55.374646: [debug] SELECT "id", "config_cache_id", "index", "option" FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) ORDER BY "index"; [PersistInt64 2]
2020-01-17 02:42:55.375074: [debug] SELECT "id", "config_cache_id", "index", "option" FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) ORDER BY "index"; [PersistInt64 2]
2020-01-17 02:42:55.375328: [debug] SELECT "id", "config_cache_id", "ghc_pkg_id" FROM "config_cache_dep" WHERE ("config_cache_id"=?); [PersistInt64 2]
2020-01-17 02:42:55.376247: [debug] SELECT "id", "config_cache_id", "component" FROM "config_cache_component" WHERE ("config_cache_id"=?); [PersistInt64 2]
2020-01-17 02:42:55.377000: [debug] Checking if we are going to build multiple executables with the same name
2020-01-17 02:42:55.377130: [debug] Executing the build plan
2020-01-17 02:42:55.378215: [info] bar-0.1.0.0: unregistering (missing dependencies: foo)
2020-01-17 02:42:55.378317: [info] foo-0.1.0.0: unregistering (--force-dirty specified)
2020-01-17 02:42:55.378475: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --no-user-package-db --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb/ unregister --user --force --ipid bar-0.1.0.0-Als2OLbMFv7BR5x6Mmi9yt foo-0.1.0.0-LplreLjcOnnO4k14IKdYr
2020-01-17 02:42:55.412285: [debug] Process finished in 33ms: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --no-user-package-db --package-db=/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb/ unregister --user --force --ipid bar-0.1.0.0-Als2OLbMFv7BR5x6Mmi9yt foo-0.1.0.0-LplreLjcOnnO4k14IKdYr
2020-01-17 02:42:55.412754: [debug] SELECT "id","directory","type","pkg_src","active","path_env_var","haddock" FROM "config_cache" WHERE "directory"=? AND "type"=?; [PersistText "/home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/",PersistText "config"]
2020-01-17 02:42:55.412998: [debug] SELECT "id", "config_cache_id", "index", "option" FROM "config_cache_dir_option" WHERE ("config_cache_id"=?) ORDER BY "index"; [PersistInt64 1]
2020-01-17 02:42:55.413252: [debug] SELECT "id", "config_cache_id", "index", "option" FROM "config_cache_no_dir_option" WHERE ("config_cache_id"=?) ORDER BY "index"; [PersistInt64 1]
2020-01-17 02:42:55.413411: [debug] SELECT "id", "config_cache_id", "ghc_pkg_id" FROM "config_cache_dep" WHERE ("config_cache_id"=?); [PersistInt64 1]
2020-01-17 02:42:55.413539: [debug] SELECT "id", "config_cache_id", "component" FROM "config_cache_component" WHERE ("config_cache_id"=?); [PersistInt64 1]
2020-01-17 02:42:55.414179: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:55.417413: [debug] Finished in 3ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:55.419835: [info] foo> build (lib + exe)
2020-01-17 02:42:55.420063: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:foo exe:foo-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:55.454225: [info] foo> Preprocessing library for foo-0.1.0.0..
2020-01-17 02:42:55.454398: [info] foo> Building library for foo-0.1.0.0..
2020-01-17 02:42:55.856683: [info] foo> Preprocessing executable 'foo-exe' for foo-0.1.0.0..
2020-01-17 02:42:55.857080: [info] foo> Building executable 'foo-exe' for foo-0.1.0.0..
2020-01-17 02:42:56.222985: [debug] Process finished in 803ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build lib:foo exe:foo-exe --ghc-options " -fdiagnostics-color=always"
2020-01-17 02:42:56.223165: [debug] Start: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:56.225215: [debug] Finished in 2ms: getPackageFiles /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/foo.cabal
2020-01-17 02:42:56.225946: [info] foo> copy/register
2020-01-17 02:42:56.226080: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:56.250186: [info] foo> Installing library in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/lib/x86_64-linux-ghc-8.6.5/foo-0.1.0.0-LplreLjcOnnO4k14IKdYr
2020-01-17 02:42:56.257102: [info] foo> Installing executable foo-exe in /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/bin
2020-01-17 02:42:56.257260: [warn] foo> Warning: The directory
2020-01-17 02:42:56.257368: [warn] foo> /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/.stack-work/install/x86_64-linux/fcf702114784a0d6bc6b977fc8845b3cdcd3d29f6ff0a5013c8f619ff05c0223/8.6.5/bin
2020-01-17 02:42:56.257441: [warn] foo> is not in the system search path.
2020-01-17 02:42:56.279676: [debug] Process finished in 53ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 copy
2020-01-17 02:42:56.280030: [debug] Run process within /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/foo/: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:56.427926: [info] foo> Registering library for foo-0.1.0.0..
2020-01-17 02:42:56.433960: [debug] Process finished in 154ms: /home/lehins/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 register
2020-01-17 02:42:56.434238: [debug] Run process: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb describe --simple-output foo --expand-pkgroot
2020-01-17 02:42:56.463352: [error] Received ExitFailure 1 when running
Raw command: /home/lehins/.stack/programs/x86_64-linux/ghc-8.6.5/bin/ghc-pkg-8.6.5 --user --no-user-package-db --package-db /home/lehins/github/bugs/haskell/stack-ghc-pkg-cannot-find-package/bar/.stack-work/install/x86_64-linux/6e8cf5cfcbafe9288c6b6f9d101ee7ce04c580185a8a551747a7deb757da5059/8.6.5/pkgdb describe --simple-output foo --expand-pkgroot
Standard error:

ghc-pkg: cannot find package foo

Progress 1/2
